<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Reparaciones</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .main-content {
            padding: 20px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .form-section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            height: 80px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-row-three {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(86, 171, 47, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #00cec9, #55a3ff);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 206, 201, 0.4);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .search-section {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #bee5eb;
        }

        .search-container {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
        }

        .sort-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .repair-list {
            margin-top: 20px;
        }

        .repair-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }

        .repair-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .repair-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .repair-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 16px;
        }

        .repair-cost {
            color: #27ae60;
            font-weight: bold;
            font-size: 18px;
        }

        .repair-details {
            color: #666;
            line-height: 1.5;
        }

        .repair-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .photo-section {
            margin-top: 15px;
        }

        .photo-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .photo-item {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .photo-remove {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-upload {
            width: 100px;
            height: 100px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #f8f9fa;
            font-size: 24px;
            color: #666;
            transition: all 0.3s;
        }

        .photo-upload:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .photo-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-row-three {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                justify-content: center;
            }
            
            .repair-actions {
                flex-direction: column;
            }

            .search-container {
                flex-direction: column;
                align-items: stretch;
            }

            .sort-controls {
                justify-content: center;
            }
        }

        .hidden {
            display: none;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }

        .status-pendiente {
            background: #fff3cd;
            color: #856404;
        }

        .status-en-proceso {
            background: #d4edda;
            color: #155724;
        }

        .status-completado {
            background: #d1ecf1;
            color: #0c5460;
        }

        .result-count {
            color: #666;
            font-style: italic;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üîß</div>
            <h1>Control de Reparaciones</h1>
            <p>Gestiona tus servicios de reparaci√≥n</p>
        </div>

        <div class="main-content">
            <!-- Formulario -->
            <div class="form-section">
                <h2 id="form-title">Agregar Nueva Reparaci√≥n</h2>
                <form id="repair-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cliente">Nombre del Cliente</label>
                            <input type="text" id="cliente" name="cliente">
                        </div>
                        <div class="form-group">
                            <label for="contacto">Contacto</label>
                            <input type="text" id="contacto" name="contacto" placeholder="Tel√©fono o email">
                        </div>
                    </div>
                    
                    <div class="form-row-three">
                        <div class="form-group">
                            <label for="modelo">Modelo/Equipo</label>
                            <input type="text" id="modelo" name="modelo">
                        </div>
                        <div class="form-group">
                            <label for="imei">IMEI</label>
                            <input type="text" id="imei" name="imei" placeholder="IMEI del dispositivo">
                        </div>
                        <div class="form-group">
                            <label for="costo">Costo ($)</label>
                            <input type="number" id="costo" name="costo" step="0.01" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="reparacion">Tipo de Reparaci√≥n</label>
                            <input type="text" id="reparacion" name="reparacion">
                        </div>
                        <div class="form-group">
                            <label for="estado">Estado</label>
                            <select id="estado" name="estado">
                                <option value="pendiente">Pendiente</option>
                                <option value="en-proceso">En Proceso</option>
                                <option value="completado">Completado</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="observaciones">Observaciones</label>
                        <textarea id="observaciones" name="observaciones" placeholder="Detalles adicionales, problemas encontrados, etc."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Fotos</label>
                        <div class="photo-container" id="photo-container">
                            <div class="photo-upload" onclick="document.getElementById('photo-input').click()">
                                üì∑
                            </div>
                        </div>
                        <input type="file" id="photo-input" accept="image/*" multiple style="display: none;" onchange="handlePhotoUpload(event)">
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">
                            <span id="btn-text">Guardar Reparaci√≥n</span>
                        </button>
                        <button type="button" class="btn btn-secondary" id="btn-cancel" onclick="cancelEdit()" style="display: none;">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>

            <!-- B√∫squeda y Ordenamiento -->
            <div class="search-section">
                <h2>Buscar y Ordenar</h2>
                <div class="search-container">
                    <input type="text" id="search-input" class="search-input" placeholder="Buscar por cliente, modelo, IMEI, tipo de reparaci√≥n...">
                    <div class="sort-controls">
                        <select id="sort-by">
                            <option value="fecha">Fecha</option>
                            <option value="cliente">Cliente (A-Z)</option>
                            <option value="modelo">Modelo (A-Z)</option>
                            <option value="costo">Costo</option>
                            <option value="estado">Estado</option>
                        </select>
                        <button class="btn btn-info" id="sort-order" onclick="toggleSortOrder()">‚¨á</button>
                        <button class="btn btn-secondary" onclick="clearSearch()">Limpiar</button>
                    </div>
                </div>
            </div>

            <!-- Botones de Acci√≥n -->
            <div class="form-section">
                <h2>Acciones</h2>
                <div class="button-group">
                    <button class="btn btn-success" onclick="exportData()">
                        üì• Hacer Copia de Seguridad
                    </button>
                    <button class="btn btn-warning" onclick="importData()">
                        üì§ Restaurar Copia
                    </button>
                    <button class="btn btn-danger" onclick="clearAllData()">
                        üóë Borrar Todo
                    </button>
                </div>
                <input type="file" id="file-input" accept=".json" style="display: none;" onchange="handleFileImport(event)">
            </div>

            <!-- Lista de Reparaciones -->
            <div class="repair-list">
                <h2>Reparaciones Registradas</h2>
                <div class="result-count" id="result-count" style="display: none;"></div>
                <div id="repairs-container">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <p>No hay reparaciones registradas a√∫n.<br>Agrega tu primera reparaci√≥n usando el formulario de arriba.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let repairs = [];
        let editingIndex = -1;
        let currentPhotos = [];
        let sortOrder = 'desc'; // desc para m√°s reciente primero
        let filteredRepairs = [];

        // Cargar datos al iniciar
        window.onload = function() {
            loadData();
            displayRepairs();
            setupEventListeners();
        };

        function setupEventListeners() {
            // B√∫squeda en tiempo real
            document.getElementById('search-input').addEventListener('input', function() {
                filterAndDisplayRepairs();
            });

            // Cambio de ordenamiento
            document.getElementById('sort-by').addEventListener('change', function() {
                filterAndDisplayRepairs();
            });

            // Manejar env√≠o del formulario
            document.getElementById('repair-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveRepair();
            });
        }

        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        currentPhotos.push({
                            id: Date.now() + Math.random(),
                            data: e.target.result,
                            name: file.name
                        });
                        displayPhotos();
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            event.target.value = '';
        }

        function displayPhotos() {
            const container = document.getElementById('photo-container');
            container.innerHTML = '';
            
            // Agregar fotos existentes
            currentPhotos.forEach((photo, index) => {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-item';
                photoDiv.innerHTML = `
                    <img src="${photo.data}" alt="${photo.name}">
                    <button class="photo-remove" onclick="removePhoto(${index})">√ó</button>
                `;
                container.appendChild(photoDiv);
            });
            
            // Agregar bot√≥n para m√°s fotos
            const uploadDiv = document.createElement('div');
            uploadDiv.className = 'photo-upload';
            uploadDiv.innerHTML = 'üì∑';
            uploadDiv.onclick = () => document.getElementById('photo-input').click();
            container.appendChild(uploadDiv);
        }

        function removePhoto(index) {
            currentPhotos.splice(index, 1);
            displayPhotos();
        }

        function saveRepair() {
            const formData = new FormData(document.getElementById('repair-form'));
            const repair = {
                id: editingIndex >= 0 ? repairs[editingIndex].id : Date.now(),
                cliente: formData.get('cliente') || '',
                contacto: formData.get('contacto') || '',
                modelo: formData.get('modelo') || '',
                imei: formData.get('imei') || '',
                reparacion: formData.get('reparacion') || '',
                costo: parseFloat(formData.get('costo')) || 0,
                estado: formData.get('estado'),
                observaciones: formData.get('observaciones') || '',
                fecha: editingIndex >= 0 ? repairs[editingIndex].fecha : new Date().toLocaleDateString(),
                fechaCreacion: editingIndex >= 0 ? repairs[editingIndex].fechaCreacion : new Date().toISOString(),
                fotos: [...currentPhotos]
            };

            if (editingIndex >= 0) {
                repairs[editingIndex] = repair;
                editingIndex = -1;
                document.getElementById('form-title').textContent = 'Agregar Nueva Reparaci√≥n';
                document.getElementById('btn-text').textContent = 'Guardar Reparaci√≥n';
                document.getElementById('btn-cancel').style.display = 'none';
            } else {
                repairs.push(repair);
            }

            saveData();
            filterAndDisplayRepairs();
            document.getElementById('repair-form').reset();
            currentPhotos = [];
            displayPhotos();
        }

        function filterAndDisplayRepairs() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const sortBy = document.getElementById('sort-by').value;
            
            // Filtrar reparaciones
            filteredRepairs = repairs.filter(repair => {
                return repair.cliente.toLowerCase().includes(searchTerm) ||
                       repair.modelo.toLowerCase().includes(searchTerm) ||
                       repair.imei.toLowerCase().includes(searchTerm) ||
                       repair.reparacion.toLowerCase().includes(searchTerm) ||
                       repair.contacto.toLowerCase().includes(searchTerm) ||
                       repair.observaciones.toLowerCase().includes(searchTerm);
            });

            // Ordenar reparaciones
            filteredRepairs.sort((a, b) => {
                let aValue, bValue;
                
                switch(sortBy) {
                    case 'fecha':
                        aValue = new Date(a.fechaCreacion);
                        bValue = new Date(b.fechaCreacion);
                        break;
                    case 'cliente':
                        aValue = a.cliente.toLowerCase();
                        bValue = b.cliente.toLowerCase();
                        break;
                    case 'modelo':
                        aValue = a.modelo.toLowerCase();
                        bValue = b.modelo.toLowerCase();
                        break;
                    case 'costo':
                        aValue = a.costo;
                        bValue = b.costo;
                        break;
                    case 'estado':
                        aValue = a.estado;
                        bValue = b.estado;
                        break;
                    default:
                        aValue = a.fechaCreacion;
                        bValue = b.fechaCreacion;
                }

                if (sortOrder === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });

            displayFilteredRepairs();
        }

        function displayFilteredRepairs() {
            const container = document.getElementById('repairs-container');
            const resultCount = document.getElementById('result-count');
            
            if (filteredRepairs.length === 0) {
                const searchTerm = document.getElementById('search-input').value;
                if (searchTerm) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                            <p>No se encontraron reparaciones que coincidan con "${searchTerm}"</p>
                        </div>
                    `;
                    resultCount.style.display = 'none';
                } else if (repairs.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <p>No hay reparaciones registradas a√∫n.<br>Agrega tu primera reparaci√≥n usando el formulario de arriba.</p>
                        </div>
                    `;
                    resultCount.style.display = 'none';
                }
                return;
            }

            // Mostrar contador de resultados
            const totalRepairs = repairs.length;
            const currentResults = filteredRepairs.length;
            if (currentResults < totalRepairs) {
                resultCount.textContent = Mostrando ${currentResults} de ${totalRepairs} reparaciones;
                resultCount.style.display = 'block';
            } else {
                resultCount.style.display = 'none';
            }

            container.innerHTML = filteredRepairs.map((repair, originalIndex) => {
                const realIndex = repairs.findIndex(r => r.id === repair.id);
                const photosHtml = repair.fotos && repair.fotos.length > 0 ? `
                    <div class="photo-section">
                        <strong>Fotos:</strong>
                        <div class="photo-preview">
                            ${repair.fotos.map(photo => `
                                <img src="${photo.data}" alt="${photo.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;">
                            `).join('')}
                        </div>
                    </div>
                ` : '';

                return `
                    <div class="repair-item">
                        <div class="repair-header">
                            <div class="repair-title">${repair.cliente || 'Sin cliente'} - ${repair.modelo || 'Sin modelo'}</div>
                            <div class="repair-cost">$${repair.costo.toFixed(2)}</div>
                        </div>
                        <div class="repair-details">
                            <p><strong>Contacto:</strong> ${repair.contacto || 'No especificado'}</p>
                            <p><strong>IMEI:</strong> ${repair.imei || 'No especificado'}</p>
                            <p><strong>Reparaci√≥n:</strong> ${repair.reparacion || 'No especificado'}</p>
                            <p><strong>Estado:</strong> <span class="status-badge status-${repair.estado}">${repair.estado.charAt(0).toUpperCase() + repair.estado.slice(1)}</span></p>
                            <p><strong>Fecha:</strong> ${repair.fecha}</p>
                            ${repair.observaciones ? <p><strong>Observaciones:</strong> ${repair.observaciones}</p> : ''}
                            ${photosHtml}
                        </div>
                        <div class="repair-actions">
                            <button class="btn btn-primary" onclick="editRepair(${realIndex})">‚úè Editar</button>
                            <button class="btn btn-danger" onclick="deleteRepair(${realIndex})">üóë Eliminar</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayRepairs() {
            filteredRepairs = [...repairs];
            filterAndDisplayRepairs();
        }

        function editRepair(index) {
            const repair = repairs[index];
            editingIndex = index;
            currentPhotos = [...(repair.fotos || [])];
            
            document.getElementById('cliente').value = repair.cliente;
            document.getElementById('contacto').value = repair.contacto;
            document.getElementById('modelo').value = repair.modelo;
            document.getElementById('imei').value = repair.imei;
            document.getElementById('reparacion').value = repair.reparacion;
            document.getElementById('costo').value = repair.costo;
            document.getElementById('estado').value = repair.estado;
            document.getElementById('observaciones').value = repair.observaciones;
            
            displayPhotos();
            
            document.getElementById('form-title').textContent = 'Editar Reparaci√≥n';
            document.getElementById('btn-text').textContent = 'Actualizar Reparaci√≥n';
            document.getElementById('btn-cancel').style.display = 'inline-block';
            
            // Scroll al formulario
            document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelEdit() {
            editingIndex = -1;
            currentPhotos = [];
            document.getElementById('form-title').textContent = 'Agregar Nueva Reparaci√≥n';
            document.getElementById('btn-text').textContent = 'Guardar Reparaci√≥n';
            document.getElementById('btn-cancel').style.display = 'none';
            document.getElementById('repair-form').reset();
            displayPhotos();
        }

        function deleteRepair(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta reparaci√≥n?')) {
                repairs.splice(index, 1);
                saveData();
                filterAndDisplayRepairs();
            }
        }

        function toggleSortOrder() {
            sortOrder = sortOrder === 'asc' ?
